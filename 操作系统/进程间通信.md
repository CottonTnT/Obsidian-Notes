# 1 匿名管道


 ![[Pasted image 20240520224658.png]]
- 管道通信时，需要产生两次拷贝，一次从用户空间拷贝进内核缓冲区，一次从内核缓冲区拷贝进用户空间 

## 1.1 匿名管道读写规则
1. 读写端正常，若管道如果为空，读端就要阻塞；
2. 读写端正常，若管道如果被写满，写端被阻塞；
3. 读端正常读，写端关闭，读端就会读到0，表明读到pipe文件末尾。这种情况，读端并不会阻塞。
4. 写端正常写，读端关闭，操作系统会用13号信号SIGPIPE杀死系统中正在写入的进程。


## 1.2 管道的特点
1. 具有血缘关系的进程才可以进行通信（常用于父子通信）；
2. 管道是半双工的，数据只能单向流动；
3. 父子进程是会进程协同的，匿名管道会提供同步与互斥机制——保护管道文件的数据安全；
4. 管道提供面向流式的通信服务——面向字节流；
5. 管道是基于文件的，而文件的生命周期是随进程的。当进程执行结束，则对应的匿名管道文件会被释放。


# 2 命名管道

函数接口创建命名管道
![[Pasted image 20240521023046.png]]
```c
#include <unistd.h>
int main(){
	mkfifo("fifo-file", 0666);
	return 0;
}
```


- 当读进程读取命名管道中的内容时，如果内部为空（写进程还没有写），则会阻塞等待；写进程执行`open`系统调用时就会开始阻塞
- 写进程写入命名管道的内容时，如果读进程还没有读，则会阻塞等待


如果不希望,则可以在`open`时，已`O_NONBLOCK`模式打开
```c
int fd = open("fifo_file", O_WDONLY  | O_NONBLOCK);
```




