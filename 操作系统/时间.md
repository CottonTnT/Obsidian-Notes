# 1 时间简史

[计算机时间到底是怎么来的？程序员必看的时间知识！-CSDN博客](https://blog.csdn.net/kevin_tech/article/details/120944679)

[[apue] 一图读懂 Unix 时间日期例程相互关系 - goodcitizen - 博客园 (cnblogs.com)](https://www.cnblogs.com/goodcitizen/p/unix_date_time_api_relationship_in_one_picture.html)

# 2 linux时间

相关数据结构
```cpp
1. typedef long time_t; // 通常定义为 long，表示秒数    

	// 这是C语言标准定义的数据类型，通常在 `<time.h>` 头文件中定义。它用于表示自Unix纪元以来的秒数。虽然它在Linux系统中广泛使用，但它也是C标准库的一部分。

2. struct timespec { 
	time_t tv_sec; // 秒 
	long tv_nsec; // 纳秒 
}; 
    // 这是POSIX标准定义的结构，通常在 `<time.h>` 头文件中定义。它用于表示更精确的时间，包含秒和纳秒。

3.  struct timeval { 

	time_t tv_sec; // 秒 
	suseconds_t tv_usec; // 微秒 
}; 
    - 这也是POSIX标准定义的结构，通常在 `<sys/time.h>` 头文件中定义。它包含秒和微秒，常用于时间差测量。

4. struct tm{
	int tm_sec; // seconds after the minute [0-60] 
	int tm_min; // minutes after the hour [0-59] 
	int tm_hour; // hours since midnight [0-23] 
	int tm_mday; // day of the month [1-31] 
	int tm_mon; // months since January [0-11] 
	int tm_year; // years since 1900 
	int tm_wday; // days since Sunday [0-6] 
	int tm_yday; // days since January 1 [0-365] 
	int tm_isdst; // Daylight Saving Time flag 
}
// 这是POSIX标准定义的结构，通常在 `<time.h>` 头文件中定义。它用于表示更精确的时间，包含秒和纳秒。
    
5. typedef long clock_t; // 实现定义的类型，通常也是 long
    
    - 这是C语言标准定义的数据类型，通常在 `<time.h>` 头文件中定义。它表示处理器时间（CPU time），用于衡量程序执行的时间。
```
## 2.1 linux进程时间

### 2.1.1 墙上时钟时间

墙上时钟时间 wall clock time： 又简称时钟时间，从进程开始运行到结束，系统时钟走过的时间（时钟数），包含了进程阻塞、等待的时间。  
每秒钟嘀嗒数， 可通过`sysconf(_SC_CLK_TCK)`获取

注意: 如果调用clock()计算进程/算法运行时间, 是不包括阻塞(含sleep)时间的.

### 2.1.2 用户CPU时间

用户CPU时间：用户进程在用户态执行时间。

### 2.1.3 系统CPU时间

系统CPU时间：用户进程在内核态执行时间。

### 2.1.4 三者之间关系

(墙上)时钟时间 = 阻塞时间 + 就绪时间 + 运行时间  
运行时间 = 用户CPU时间 + 系统CPU时间

### 2.1.5 \#include <sys/times>

获取进程时间

_**原型**_

```c
#include <sys/times.h>
clock_t times(struct tms *buf);
```

tms结构：

```c
struct tms {
    clock_t tms_utime;  /* user CPU time */
    clock_t tms_stime;  /* system CPU time */
    clock_t tms_cutime; /* user CPU time,terminated children */
    clock_t tms_cstime; /* system CPU time,terminated children */
};
```

_**功能**_  
获取当前进程墙上时钟时间，用户CPU时间，系统CPU时钟时间

_**返回值**_  
1.函数返回墙上时钟时间。  
进程开始和结束时，可以分别获取到2个返回值，做差值即为进程的墙上时钟时间。运行时间足够长可能溢出（可能性较小）

2.输出参数buf，包含用户CPU时间，系统CPU时间。



### 2.1.6 Linux系统调用：

1. **`time`**:
    
    - 获取当前时间的`time_t`表示。
2. **`clock_gettime`**:
    
    - 用于获取指定时钟的精确时间，如实时时钟、进程CPU时钟等。
3. **`gettimeofday`**:
    
    - 获取当前时间的`struct timeval`表示，包括秒和微秒。

### 2.1.7 C标准库函数：

1. **`time`** (C标准库函数):
    
    - 返回从纪元至今的秒数。
2. **`ctime`**:
    
    - 将`time_t`转换为字符串形式的日期和时间。
3. **`localtime`**:
    
    - 将`time_t`转换为本地时间的`struct tm`。
4. **`gmtime`**:
    
    - 将`time_t`转换为协调世界时（UTC）的`struct tm`。
5. **`mktime`**:
    
    - 将`struct tm`转换为自纪元以来的秒数。
6. **`difftime`**:
    
    - 计算两个`time_t`值之间的差异，以秒为单位。
7. **`asctime`**:
    
    - 将`struct tm`转换为可读的字符串形式。
8. **`strftime`**:
    
    - 用于格式化日期和时间到字符串。
9. **`clock`**:
    
    - 返回处理器时钟的`clock_t`表示，用于测量程序执行时间。
10. **`nanosleep`**:
    
    - 使调用线程挂起指定的纳秒数。

### 2.1.8 其他相关函数和工具：

- **`alarm`**:
    
    - 安装一个定时器，当定时器到期时，向进程发送`SIGALRM`。
- **`setitimer`** 和 **`getitimer`**:
    
    - 设置或获取计时器，可以用来测量时间间隔或周期性地发送信号。
- **`stime`** (较少使用):
    
    - 设置系统的时间。
- **`getdate`** (非POSIX标准):
    
    - 将字符串转换为`struct tm`。
# 3 C/C++ 时间库


[C++ ctime、chrono时间函数库_c++ ctime 定时执行函数-CSDN博客](https://blog.csdn.net/qq_41939214/article/details/103302935)



```c
struct tm { 
int tm_sec; // seconds after the minute [0-60] 
int tm_min; // minutes after the hour [0-59] 
int tm_hour; // hours since midnight [0-23] 
int tm_mday; // day of the month [1-31] 
int tm_mon; // months since January [0-11] 
int tm_year; // years since 1900 
int tm_wday; // days since Sunday [0-6] 
int tm_yday; // days since January 1 [0-365] 
int tm_isdst; // Daylight Saving Time flag 
};
```