[【网络】【TCP】用了 TCP 协议，数据一定不会丢吗](https://www.cnblogs.com/kukuxjx/p/17458982.html)

[网络】【TCP】如何理解是 TCP 面向字节流协议](https://www.cnblogs.com/kukuxjx/p/17459283.html)


# 1 TCP

## 1.1 TCP服务的特点
>。TCP协议相对于 UDP协议的特点是：面向连接、字节流和可靠传输。

### 1.1.1 面向连接

 使用TCP协议通信的双方必须先建立连接，然后才能开始数据的读写。双方都必须为*该连接分配必要的内核资源*，以管理连接的状态和连接上数据的传输。TCP连接是全双工的，即双方的数据读写可以通过一个连接进行。*完成数据交换之后，通信双方都必须断开连接以释放 系统资源*。


 TCP协议的这种连接是*一对一*的，所以基于广播和多播（目标是多 个主机地址）的应用程序不能使用TCP服务。而无连接协议UDP则非常 适合于广播和多播。 


### 1.1.2 字节流

 当发送端应用程序连续执行多次写操作时，TCP模块*先将这些数据放入TCP发送缓冲区*中。当TCP 模块*真正开始发送数据时*，发送缓冲区中这些等待发送的*数据可能被 封装成一个或多个TCP报文段*发出。因此，*TCP模块发送出的TCP报文段的个数和应用程序执行的写操作次数之间没有固定的数量关系*。 

 当接收端收到一个或多个TCP报文段后，TCP模块将它们携带的应用程序数据*按照TCP报文段的序号（见后文）依次放入TCP接收缓冲区*中，并通知应用程序读取数据。接收端应用程序*可以一次性*将TCP接收缓冲区中的数据全部读出，*也可以分多次读取*，这**取决于用户指定的 应用程序读缓冲区的大小**。因此，*应用程序执行的读操作次数和TCP模块接收到的TCP报文段个数之间也没有固定的数量关系*。 

综上所述，**发送端执行的写操作次数和接收端执行的读操作次数之间没有任何数量关系**，这就是**字节流的概念**：*应用程序对数据的发送和接收是没有边界限制的*。UDP则不然。发送端应用程序每执行一次写操作，UDP模块就将其封装成一个UDP数据报并发送之。接收端*必须及时针对每一个UDP数据报执行读操作*（通过recvfrom系统调 用），否则就会丢包（这经常发生在较慢的服务器上）。并且，*如果用户没有指定足够的应用程序缓冲区来读取UDP数据，则UDP数据将被截断*

![[Pasted image 20240531003008.png]]
### 1.1.3 可靠传输


TCP传输是可靠的。

1. 首先，TCP协议采用发送应答机制，即发送端发送的每个TCP报文段都必须得到接收方的应答，才认为这个TCP报文 段传输成功。
2. 其次，TCP协议采用超时重传机制，发送端在发送出一个 TCP报文段之后启动定时器，如果在定时时间内未收到应答，它将重发 该报文段。
3. 最后，因为TCP报文段最终是以IP数据报发送的，而IP数据报到达接收端可能乱序、重复，所以TCP协议还会对接收到的TCP报文段重排、整理，再交付给应用层。 

UDP协议则和IP协议一样，提供不可靠服务。它们都需要上层协议来处理数据确认和超时重传


## 1.2 TCP头部结构

### 1.2.1 TCP固定头部结构

![[Pasted image 20240531003546.png]]

![[Pasted image 20240531003733.png]]
## 1.3 TCP 状态转移

